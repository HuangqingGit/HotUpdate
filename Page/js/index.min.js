$(function(){let messMV=new Vue({el:'#app',data:{hot_now_version:'',hot_new_version:'',Joe_now_version:'',Joe_new_version:'',Joe_versions_mes:'',hot_box_show:false,hot_new_data:[],hot_list_data:[],log_activeNames:0,up_activeNames:['1'],Joe_update:'',config:[],Loading_text:'',Joe_uplog:'',hot_show:false,show:true,log:false,znew:false,drawer:false,Loading:false,disabled:false,},mounted(){$.getJSON('/usr/plugins/HotUpdate/config.json',data=>{this.config=data});this.Joe_now_version=this.getCookie('Joe_now_version');this.getCollect();this.get_new_vs();if(this.isMobile()){this.disabled=true}},methods:{get_new_vs(){axios.get('https://port.kuckji.cn',{params:{appid:'hot_get_new_version',secret:'z1I4HMCGqAUWmcQl6Du'}}).then((res)=>{this.show_main=true;res=res.data;if(!res.code){if(Number(res.data.vsnum)>this.config.Number){this.hot_now_version=this.config.Version;this.hot_new_version=res.data.version;this.hot_new_data=this.uni_cn(res.data.uplog);this.hot_box_show=true}}})},get_list_vs(){this.drawer=true;axios.get('https://port.kuckji.cn',{params:{appid:'hot_get_list_version',secret:'z1I4HMCGqAUWmcQl6Du'}}).then((res)=>{res=res.data;if(!res.code){this.hot_show=true;this.hot_list_data=res.data}})},getCollect(){axios.get('https://78.al/api.php?type=collect&key=18e958d8c7fa5d435844f95c9f254fca').then((res)=>{res=res.data;if(res.success){this.Joe_new_version=res.title;this.Joe_update=res.update;this.Joe_uplog=res.content;this.show=false;this.log=true;if(parseInt(res.title.replace(/\./g,''))>parseInt(this.getCookie('Joe_now_version').replace(/\./g,''))){this.Joe_versions_mes="发现新版本 "+this.Joe_new_version;this.znew=true}else{this.Joe_versions_mes="已是最新版本"}}else{this.Tips('获取主题更新失败 Unknown Error!','error')}})},Joe_updata(){this.Loading_text='正在更新 Joe 请勿刷新页面';this.Loading=true;axios.get('../usr/plugins/HotUpdate/assets/Joe_update.php').then((res)=>{res=res.data;if(!res.code){let exp=new Date();exp.setTime(exp.getTime()+60*10*10);document.cookie="Joe_now_version="+escape(this.Joe_new_version)+";expires="+exp.toGMTString();this.Joe_now_version=this.Joe_new_version;this.Loading=false;this.znew=false;this.Notice('成功','<h4 style="margin: 3px 0">Joe主题更新成功</h4><p>(请按Ctrl + F5刷新缓存)</p>','success');this.getCollect()}else{this.Loading=false;this.Tips('升级失败 Error code：!'+res.code,'error')}})},Hot_updata(){this.Loading_text='正在更新 Hotupdate 请勿刷新页面';this.Loading=true;axios.get('../usr/plugins/HotUpdate/assets/Hot_update.php').then((res)=>{res=res.data;if(!res.code){this.up_record();this.hot_now_version=this.hot_new_version;this.Loading=false;this.Notice('成功','<h4 style="margin: 3px 0">Hotupdate更新成功</h4><p>(请按Ctrl + F5刷新缓存)</p>','success');this.hot_box_show=false}else{this.Loading=false;this.Tips('升级失败 Error code：!'+res.code,'error')}})},up_record(){axios.get('https://port.kuckji.cn',{params:{appid:'hot_push_log',secret:'z1I4HMCGqAUWmcQl6Du',domain_name:this.getCookie('V_domain_name')}})},uni_cn(str){let cn=[];str.forEach((value,key,ite)=>{let v=value.title.split('u').join("\\u");str=v.replace(/\\/g,"%");let obj={};obj.term=unescape(str);cn.push(obj)});return cn},getLocalTime(ns){let now=new Date(ns*1000);let year=now.getFullYear();let month=now.getMonth()+1;let date=now.getDate()<10?"0"+now.getDate():now.getDate();let hour=now.getHours()<10?"0"+now.getHours():now.getHours();let minute=now.getMinutes()<10?"0"+now.getMinutes():now.getMinutes();let second=now.getSeconds()<10?"0"+now.getSeconds():now.getSeconds();month=month<10?"0"+month:month;return year+"-"+month+"-"+date+" "+hour+":"+minute+":"+second},getCookie(name){var strcookie=document.cookie;var arrcookie=strcookie.split("; ");for(var i=0;i<arrcookie.length;i++){var arr=arrcookie[i].split("=");if(arr[0]==name){return arr[1]}}return false},handleClose(done){this.$confirm('关闭更新程序将不为您更新插件，确认关闭？').then(_=>{done()}).catch(_=>{})},errorHandler(){return true},Tips(mes,type){this.$message({message:mes,type:type})},Notice(title,mes,type){this.$notify({title:title,dangerouslyUseHTMLString:true,message:mes,type:type})},OpenUrl(url,type){if(type){window.open(url)}else{window.location.href=url}},isMobile(){let userAgentInfo=navigator.userAgent;let mobileAgents=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let mobile_flag=false;for(let v=0;v<mobileAgents.length;v++){if(userAgentInfo.indexOf(mobileAgents[v])>0){mobile_flag=true;return mobile_flag}}let screen_width=window.screen.width;let screen_height=window.screen.height;if(screen_width<500&&screen_height<800){mobile_flag=true}return mobile_flag},}})});