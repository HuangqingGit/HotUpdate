$(function() {
    let hot = new Vue({
        el: '#hot', //vue绑定元素
        data: {
            config:[],                  //配置文件
            menus: [],                  //菜单目录
            ret: false,                 //返回键是否显示
            menu_fold: true,            //菜单是否折叠
            w: $(window).width(),       //window宽度
            h: $(window).height(),      //window高度
            def_active: 'Basic-0',      //当前激活的项（默认项）
            anchorname: "",             //锚点标记
        },
        mounted() {
            let htis = this;
            let form = document.querySelector(".col-tb-offset-2 > form");
            let title = document.querySelector(".typecho-page-title");
            htis.GetUrlParam('sign') === 'true' ? this.ret = true : this.ret = false;
            form.id = "hot_form"; //给表单添加一个ID
            $('.main').attr('id', 'hot_plugin_main');
            $("#hot_main").append(form); //表单插入main元素
            $(".typecho-page-title").remove();
            $("#hot_form .typecho-option-submit").remove();
            $('#hot_form').show();
            this.handleOpen('Basic');
            htis.w < 768 ? htis.menu_fold = true : htis.menu_fold = false;
            $('#hot_plugin_main').css('height', htis.h  + 'px');
            $('.logo_box').width() < 140 ? $('.logo_t').css("display","none") : $('.logo_t').css("display","block");
            
            $(window).unbind('keydown').bind('keydown', function(e) { if (e.ctrlKey && e.keyCode == 83) { $("#hot_form").submit(); return false; } });
            $(window).resize(function() {
                htis.w = $(window).width();
                htis.h = $(window).height();
                htis.w < 768 ? htis.menu_fold = true : htis.menu_fold = false;
                $('.logo_box').width() < 140 ? $('.logo_t').css("display","none") : $('.logo_t').css("display","block");
                $('#hot_plugin_main').css('height', htis.h  + 'px');
            });
            
            $.getJSON('/usr/plugins/HotUpdate/config.json', data => {
                this.config = data;
            });
            $.getJSON('/usr/plugins/HotUpdate/assets/js/json/menus.json', data => {
                this.menus = data;
            });
        },
        methods: {
            handleOpen(key) {
                $('#hot_main').animate({scrollTop: 0}, 400);
                this.def_active = key + '-0';
                $('.form_other').hide();
                $('.hot_main_ul').hide();
                $('#hot_form .' + key).show();
            },
            form_other_click(cla){
                this.def_active = cla;
                $('.hot_main_ul').hide();
                $('.hot_main .form_other ').hide();
                $('.hot_main .' + cla).show();
            },
            hot_Submit_form() {
                $("#hot_form").submit();
            },
            // 打开一个连接
            OpenUrl(url,type){
                if(type){window.open(url)}else{window.location.href=url};
            },
            // 锚点定位
            anchor(name,cla){
                this.form_other_click(cla);
                if(name != this.anchorname){
                    $('#hot_main').stop();
                    $('#hot_main').animate({scrollTop: $('#hot_main').scrollTop() + $('#ul_' + cla + '_' + name).offset().top -150}, 400);
                    this.anchorname = name;
                }
            },
            GetUrlParam(paraName) {
                var url = document.location.toString();
                var arrObj = url.split("?");
                if (arrObj.length > 1) {
                    var arrPara = arrObj[1].split("&");
                    var arr;
                    for (var i = 0; i < arrPara.length; i++) {
                        arr = arrPara[i].split("=");
                        if (arr != null && arr[0] == paraName) {
                            return arr[1];
                        }
                    }
                    return false;
                } else {
                    return false;
                }
            }
        }
    });
});



// document.addEventListener("DOMContentLoaded", function() {});